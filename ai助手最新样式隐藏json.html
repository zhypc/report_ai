<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ç©º HTML</title>
</head>

<body>
  <!-- ==================== é¡µé¢ç»“æ„éƒ¨åˆ† ==================== -->

  <!-- AIåŠ©æ‰‹ç»“æœå±•ç¤ºåŒºåŸŸï¼šç”¨äºåœ¨é¡µé¢ä¸»ä½“ä¸­å±•ç¤ºAIå›ç­”çš„å†…å®¹ -->
  <div id="ai-result-display"></div>

  <!--
    éšè—çš„JSONæ•°æ®åŒºåŸŸ
    - å­˜å‚¨æŠ¥å‘Šçš„å…ƒæ•°æ®å’Œåˆ†æç»“æœï¼ˆBase64ç¼–ç ï¼‰
    - åŒ…å«ï¼šsystem(ç³»ç»Ÿæç¤º)ã€context(æŠ¥å‘Šå†…å®¹)ã€instructions(å›ç­”æŒ‡ä»¤)
    - è§£ç åä½œä¸ºAIçš„èƒŒæ™¯çŸ¥è¯†ï¼Œç”¨äºå›ç­”ç”¨æˆ·é—®é¢˜
  -->
  <script id="hidden-json-data" type="application/json">
ewogICAgInN5c3RlbSI6ICLkvaDmmK/kuIDkuKrkuJPkuJrnmoTliqnmiYvvvIzkuIvpnaLmmK/mnKzmrKHmiqXlkYrnmoTlhoXlrrnvvIzpnIDopoHmiqXlkYrlhoXlrrnmnaXlm57nrZTpl67popjjgIIiLAogICAgImNvbnRleHQiOiB7CiAgInJlcG9ydF9tZXRhZGF0YSI6IHsKICAgICJ0aXRsZSI6ICLnqbrpl7TovazlvZXnu4Tmt7HluqbliIbmnpDmiqXlkYoiLAogICAgInByb2plY3RfbmFtZSI6ICJyZXBvcnTkuK3lop7liqBhaeWKqeaJi+a1i+ivlemhueebriIsCiAgICAic2FtcGxlX2luZm8iOiB7CiAgICAgICJzYW1wbGVfaWQiOiAiTFVBRF9TMSwgTFVBRF9TMiIsCiAgICAgICJzbGlkZV9pZCI6ICJMVUFEX1MxLCBMVUFEX1MyIiwKICAgICAgInNwZWNpZXMiOiAiaHMiLAogICAgICAidGlzc3VlX3R5cGUiOiAi6IK66YOoIgogICAgfSwKICAgICJhbmFseXNpc19kYXRlIjogIjIwMjUtMTEtMTciLAogICAgInBpcGVsaW5lX3ZlcnNpb24iOiAi5rex5bqm5YiG5p6QIgogIH0sCiAgImFuYWx5c2lzX21vZHVsZXMiOiB7CiAgICAiMV8wX2xvYWREYXRhIjogewogICAgICAibW9kdWxlX25hbWUiOiAi5pWw5o2u5Yqg6L29IiwKICAgICAgImRlc2NyaXB0aW9uIjogIuWOn+Wni+aVsOaNruWKoOi9veWSjOagvOW8j+i9rOaNoiIsCiAgICAgICJvdXRwdXRfc3VtbWFyeSI6ICLliqDovb3kuoYyNzgzMjjkuKrnu4bog57vvIw2NzM45Liq5Z+65ZugIiwKICAgICAgImtleV9tZXRyaWNzIjogewogICAgICAgICJ0b3RhbF9jZWxscyI6IDI3ODMyOCwKICAgICAgICAidG90YWxfZ2VuZXMiOiA2NzM4CiAgICAgIH0KICAgICAgCiAgICB9LAogICAgIjFfMV9xY0RhdGEiOiB7CiAgICAgICJtb2R1bGVfbmFtZSI6ICLotKjph4/mjqfliLYiLAogICAgICAiZGVzY3JpcHRpb24iOiAi5pWw5o2u6LSo6YeP6K+E5Lyw5ZKM6L+H5rukIiwKICAgICAgIm91dHB1dF9zdW1tYXJ5IjogIui/h+a7pOWQjuWJqeS9mTI3ODMyOOS4que7huiDnu+8jDY3MzjkuKrln7rlm6AiLAogICAgICAia2V5X21ldHJpY3MiOiB7CiAgICAgICAgImZpbHRlcmVkX2NlbGxzIjogMCwKICAgICAgICAiZmlsdGVyZWRfZ2VuZXMiOiAwLAogICAgICAgICJtaXRvX3JhdGlvX3RocmVzaG9sZCI6IDAsCiAgICAgICAgImRvdWJsZXRfc2NvcmVfdGhyZXNob2xkIjogMAogICAgICB9CiAgICB9LAogICAgIjFfMl9wcmVwcm9jZXNzRGF0YSI6IHsKICAgICAgIm1vZHVsZV9uYW1lIjogIuaVsOaNrumihOWkhOeQhiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICLmoIflh4bljJbjgIHlvZLkuIDljJbjgIHmibnmrKHmoKHmraMiLAogICAgICAib3V0cHV0X3N1bW1hcnkiOiAi5a6M5oiQ5qCH5YeG5YyW5ZKM5om55qyh5qCh5q2jIiwKICAgICAgImtleV9tZXRyaWNzIjogewogICAgICAgICJub3JtYWxpemF0aW9uX21ldGhvZCI6ICJMb2dOb3JtYWxpemUiLAogICAgICAgICJuRmVhdHVyZXMiOiAzMDAwCiAgICAgIH0KICAgIH0sCiAgICAiMV8zX3BjYURhdGEiOiB7CiAgICAgICJtb2R1bGVfbmFtZSI6ICJQQ0HliIbmnpAiLAogICAgICAiZGVzY3JpcHRpb24iOiAi5Li75oiQ5YiG5YiG5p6QIiwKICAgICAgIm91dHB1dF9zdW1tYXJ5IjogIuWujOaIkOS6hlBDQeS4u+aIkOWIhuWIhuaekCIsCiAgICAgICJrZXlfbWV0cmljcyI6IHsKICAgICAgICAibl9wY3MiOiA0MAogICAgICB9CiAgICB9LAogICAgIjFfNF9pbnRlZ3JhdGVEYXRhIjogewogICAgICAibW9kdWxlX25hbWUiOiAi5pWw5o2u5pW05ZCIIiwKICAgICAgImRlc2NyaXB0aW9uIjogIuWkmuagt+acrC/lpJrljLrln5/mlbDmja7mlbTlkIgiLAogICAgICAib3V0cHV0X3N1bW1hcnkiOiAi5a6M5oiQ5pWw5o2u5pW05ZCI77yM6K+G5Yir5om55qyh5pWI5bqUIiwKICAgICAgImtleV9tZXRyaWNzIjogewogICAgICAgICJpbnRlZ3JhdGlvbl9tZXRob2QiOiAiSGFybW9ueSIsCiAgICAgICAgImRpbV91c2UiOiAzMCwKICAgICAgICAiay53ZWlnaHQiOiA1MAogICAgICB9CiAgICB9LAogICAgIjFfNV9jbHVzdGVyUmVkdWN0aW9uRGF0YSI6IHsKICAgICAgIm1vZHVsZV9uYW1lIjogIuiBmuexu+mZjee7tCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICLpmY3nu7TogZrnsbvliIbmnpAiLAogICAgICAib3V0cHV0X3N1bW1hcnkiOiAi6K+G5YirMTXkuKrnu4bog57nvqQiLAogICAgICAia2V5X21ldHJpY3MiOiB7CiAgICAgICAgIm5fY2x1c3RlcnMiOiAxMiwKICAgICAgICAiRmluZENsdXN0ZXJzX3Jlc29sdXRpb24iOiAwLjIsCiAgICAgICAgIm4ubmVpZ2hib3JzIjogMzAKICAgICAgfQogICAgfSwKICAgICIyXzFfbGFiZWxUcmFuc2ZlciI6IHsKICAgICAgIm1vZHVsZV9uYW1lIjogIue7huiDnuexu+Wei+azqOmHiiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICLln7rkuo7lj4LogIPmlbDmja7pm4bnmoTnu4bog57nsbvlnovms6jph4oiLAogICAgICAib3V0cHV0X3N1bW1hcnkiOiAi5rOo6YeK5LqGNDDkuKrnu4bog57nvqTnmoTnsbvlnosiLAogICAgICAia2V5X21ldHJpY3MiOiB7CiAgICAgICAgInJlZmVyZW5jZV9kYXRhc2V0IjogIkdTRTEzMTkwN19MdW5nX0NhbmNlcl9maW5hbF90THVuZyIsCiAgICAgICAgInNjX2Rvd25TYW1wbGVfbnVtIjogMTAwCiAgICAgIH0sCiAgICAgICJhbm5vdGF0aW9uX3Jlc3VsdHMiOiB7CiAgICAgICAgImNsdXN0ZXJfMCI6IHsidHlwZSI6ICJGaWJyb2JsYXN0cyIsICJjb25maWRlbmNlIjogMC45Mn0sCiAgICAgICAgImNsdXN0ZXJfMSI6IHsidHlwZSI6ICJFbmRvdGhlbGlhbCBjZWxscyIsICJjb25maWRlbmNlIjogMC44OH0KICAgICAgfQogICAgfSwKICAgICIyXzJfc3RSQ1REIjogewogICAgICAibW9kdWxlX25hbWUiOiAi56m66Ze06Kej5Y2356evIiwKICAgICAgImRlc2NyaXB0aW9uIjogIuepuumXtOihqOi+vuaVsOaNrueahOe7huiDnuexu+Wei+ino+WNt+enryIsCiAgICAgICJvdXRwdXRfc3VtbWFyeSI6ICLms6jph4rkuoYzNuS4que7huiDnue+pOeahOexu+WeiyIsCiAgICAgICJrZXlfbWV0cmljcyI6IHsKICAgICAgICAiZG91YmxldF9tb2RlIjogImRvdWJsZXQiCiAgICAgIH0KICAgIH0sCiAgICAiM18xX0J1aWxkTmljaGVBc3NheSI6IHsKICAgICAgIm1vZHVsZV9uYW1lIjogIueUn+aAgeS9jeWIhuaekCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICLmnoTlu7rnlJ/mgIHkvY3lubbliIbmnpDnu4bog57nm7jkupLkvZznlKgiLAogICAgICAib3V0cHV0X3N1bW1hcnkiOiAi5p6E5bu65LqGNOS4queUn+aAgeS9jSIsCiAgICAgICJrZXlfbWV0cmljcyI6IHsKICAgICAgICAibmVpZ2hib3JzLmsiOiAyMAogICAgICB9CiAgICB9LAogICAgIjNfMl9DZWxsQ2hhdDIiOiB7CiAgICAgICJtb2R1bGVfbmFtZSI6ICLnu4bog57pgJrorq/liIbmnpAiLAogICAgICAiZGVzY3JpcHRpb24iOiAi5YiG5p6Q57uG6IOe6Ze055qE6YCa6K6v572R57ucIiwKICAgICAgIm91dHB1dF9zdW1tYXJ5IjogIuivhuWIq+S6hjExMeS4quaYvuiRl+eahOe7huiDnumAmuiur+WvuSIsCiAgICAgICJrZXlfbWV0cmljcyI6IHsKICAgICAgICAic2lnbmFsaW5nX3BhaXJzIjogMTIwCiAgICAgICAgCiAgICAgIH0KICAgIH0KICB9CiAgCn0sCiAgICAiaW5zdHJ1Y3Rpb25zIjogIuWbnuetlOmXrumimOaXtuimgeiAg+iZkeaKpeWRiuWGheWuue+8jOWvueS6jui2heWHuuiMg+WbtOeahOmXrumimOimgeaYjuehruWRiuefpeeUqOaIt++8jOWbnuetlOmXrumimOS4jeimgeS9v+eUqE1hcmtkb3du5qC85byP44CCIgogIH0K
</script>

  <!-- ==================== AIèŠå¤©å®¹å™¨ ==================== -->
  <div id="ai-chat-container">

    <!-- èŠå¤©å¼€å¯æŒ‰é’®ï¼šç‚¹å‡»æ‰“å¼€èŠå¤©çª—å£ -->
    <button id="ai-chat-toggle" onclick="toggleChat()">
      ğŸ’¬
    </button>

    <!-- èŠå¤©çª—å£ä¸»ä½“ -->
    <div id="ai-chat-window" style="display: none;">

      <!-- èŠå¤©çª—å£å¤´éƒ¨ï¼šæ˜¾ç¤ºæ ‡é¢˜å’Œæ§åˆ¶æŒ‰é’® -->
      <div id="ai-chat-header">
        <!-- å·¦ä¾§ï¼šLogoå’Œæ ‡é¢˜ -->
        <div style="display: flex; align-items: center; gap: 10px;">
          <span style="font-size: 24px;">ğŸ¤–</span>
          <div>
            <div style="font-size: 16px; font-weight: bold;">DeepSeek AI åŠ©æ‰‹</div>
            <div style="font-size: 11px; opacity: 0.9; font-weight: normal;">æ™ºèƒ½é—®ç­”åŠ©æ‰‹</div>
          </div>
        </div>
        <!-- å³ä¾§ï¼šæœ€å¤§åŒ–æŒ‰é’®å’Œå…³é—­æŒ‰é’® -->
        <div style="display: flex; align-items: center; gap: 8px;">
          <!-- æœ€å¤§åŒ–/è¿˜åŸæŒ‰é’® -->
          <button id="ai-maximize-btn" onclick="toggleMaximize()"
            style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; opacity: 0.9; transition: opacity 0.2s;"
            onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.9'">â›¶</button>
          <!-- å…³é—­æŒ‰é’® -->
          <button onclick="toggleChat()"
            style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; opacity: 0.9; transition: opacity 0.2s;"
            onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.9'">Ã—</button>
        </div>
      </div>

      <!-- API Key è¾“å…¥åŒºåŸŸï¼šé¦–æ¬¡ä½¿ç”¨æ—¶éœ€è¦è¾“å…¥DeepSeek APIå¯†é’¥ -->
      <div id="ai-api-key-section">
        <div style="width: 100%;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; color: #555;">
            <span style="font-size: 16px;">ğŸ”‘</span>
            <span style="font-size: 13px; font-weight: 500;">è¾“å…¥æ‚¨çš„ API Key</span>
          </div>
          <div style="display: flex; gap: 10px;">
            <input type="password" id="ai-api-key" placeholder="sk-..." />
            <button onclick="saveApiKey()">
              <span style="font-size: 16px;">âœ“</span>
            </button>
          </div>
          <!-- API Key çŠ¶æ€æç¤º -->
          <div class="api-key-status" id="api-key-status">æœªé…ç½®APIå¯†é’¥</div>
        </div>
      </div>

      <!-- èŠå¤©æ¶ˆæ¯å±•ç¤ºåŒºåŸŸï¼šæ˜¾ç¤ºç”¨æˆ·å’ŒAIçš„å¯¹è¯ -->
      <div id="ai-chat-messages"></div>

      <!-- é»˜è®¤é—®é¢˜åŒºåŸŸï¼šå¯æŠ˜å çš„å¿«æ·é—®é¢˜æŒ‰é’® -->
      <div id="ai-default-questions">
        <!-- æŠ˜å æ ‡é¢˜æ ï¼šç‚¹å‡»å¯å±•å¼€/æ”¶èµ· -->
        <div class="default-questions-header" onclick="toggleDefaultQuestions()">
          <span class="default-questions-title">æ‚¨å¯ä»¥è¿™æ ·é—®æˆ‘ï¼š</span>
          <span id="default-questions-arrow">â–¼</span>
        </div>
        <!-- é»˜è®¤é—®é¢˜æŒ‰é’®åˆ—è¡¨ -->
        <div id="default-questions-content">
          <div class="default-question-btn" onclick="askDefaultQuestion('è¿™ä»½æŠ¥å‘Šåˆ†æäº†å¤šå°‘ä¸ªç»†èƒå’ŒåŸºå› ï¼Ÿ')">è¿™ä»½æŠ¥å‘Šåˆ†æäº†å¤šå°‘ä¸ªç»†èƒå’ŒåŸºå› ï¼Ÿ</div>
          <div class="default-question-btn" onclick="askDefaultQuestion('æŠ¥å‘Šä¸­è¯†åˆ«äº†å“ªäº›ç»†èƒç±»å‹ï¼Ÿ')">æŠ¥å‘Šä¸­è¯†åˆ«äº†å“ªäº›ç»†èƒç±»å‹ï¼Ÿ</div>
          <div class="default-question-btn" onclick="askDefaultQuestion('è¯·æ€»ç»“ä¸€ä¸‹è¿™ä»½æŠ¥å‘Šçš„ä¸»è¦å‘ç°')">è¯·æ€»ç»“ä¸€ä¸‹è¿™ä»½æŠ¥å‘Šçš„ä¸»è¦å‘ç°</div>
        </div>
      </div>

      <!-- ç”¨æˆ·è¾“å…¥åŒºåŸŸï¼šæ–‡æœ¬æ¡†å’Œå‘é€æŒ‰é’® -->
      <div id="ai-chat-input-section">
        <textarea id="ai-user-input" placeholder="ğŸ’­ è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." rows="3"></textarea>
        <button id="ai-send-btn" onclick="sendMessage()">
          <span style="font-size: 18px;">â¤</span>
        </button>
      </div>
    </div>

    <!-- åŠ è½½æŒ‡ç¤ºå™¨ï¼ˆç›®å‰æœªä½¿ç”¨ï¼‰ -->
    <div id="loading-indicator"
      class="hidden absolute bottom-20 left-1/2 transform -translate-x-1/2 flex items-center space-x-2">
      <div class="w-2 h-2 rounded-full bg-primary animate-bounce [animation-delay:-0.3s]"></div>
      <div class="w-2 h-2 rounded-full bg-primary animate-bounce [animation-delay:-0.15s]"></div>
      <div class="w-2 h-2 rounded-full bg-primary animate-bounce"></div>
    </div>
  </div>

  <!-- ==================== CSSæ ·å¼éƒ¨åˆ† ==================== -->
  <style>
    /* ---------- AIç»“æœå±•ç¤ºåŒºåŸŸæ ·å¼ ---------- */
    /* é¡µé¢ä¸»ä½“ä¸­å±•ç¤ºAIå›ç­”çš„å®¹å™¨ */
    #ai-result-display {
      max-width: 800px;
      margin: 20px auto;
      padding: 0 20px;
    }

    /* AIå›ç­”çš„æ®µè½æ ·å¼ */
    .ai-result-paragraph {
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border-left: 4px solid #667eea;  /* å·¦ä¾§ç´«è‰²è¾¹æ¡† */
      padding: 20px 24px;
      margin-bottom: 16px;
      border-radius: 0 12px 12px 0;
      box-shadow: 0 2px 12px rgba(102, 126, 234, 0.1);
      font-size: 15px;
      line-height: 1.8;
      color: #2d3748;
      animation: fadeIn 0.4s ease-out;  /* æ·¡å…¥åŠ¨ç”» */
    }

    /* ç»“æœæ ‡é¢˜ï¼ˆç”¨æˆ·çš„é—®é¢˜ï¼‰ */
    .ai-result-paragraph .result-title {
      font-weight: 600;
      color: #667eea;
      margin-bottom: 8px;
      font-size: 16px;
    }

    /* ç»“æœå†…å®¹ï¼ˆAIçš„å›ç­”ï¼‰ */
    .ai-result-paragraph .result-content {
      color: #4a5568;
    }

    /* é«˜äº®æ•°å­—æ ·å¼ */
    .ai-result-paragraph .highlight-number {
      font-weight: 700;
      color: #764ba2;
      font-size: 1.1em;
    }

    /* æ·¡å…¥åŠ¨ç”»å®šä¹‰ */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ---------- API Key çŠ¶æ€æ ·å¼ ---------- */
    .api-key-status {
      font-size: 11px;
      color: #666;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .api-key-status.success {
      color: #4caf50;  /* æˆåŠŸçŠ¶æ€ï¼šç»¿è‰² */
    }

    .api-key-status.error {
      color: #f44336;  /* é”™è¯¯çŠ¶æ€ï¼šçº¢è‰² */
    }

    /* ---------- èŠå¤©å®¹å™¨æ ·å¼ ---------- */
    /* å›ºå®šå®šä½åœ¨å³ä¸‹è§’ */
    #ai-chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    /* ---------- èŠå¤©å¼€å¯æŒ‰é’®æ ·å¼ ---------- */
    #ai-chat-toggle {
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;  /* åœ†å½¢æŒ‰é’® */
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);  /* ç´«è‰²æ¸å˜ */
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
      z-index: 9999;
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* æ‚¬åœæ•ˆæœï¼šè½»å¾®ä¸Šç§» */
    #ai-chat-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(102, 126, 234, 0.5);
    }

    /* ç‚¹å‡»æ•ˆæœï¼šæ¢å¤åŸä½ */
    #ai-chat-toggle:active {
      transform: translateY(0);
    }

    /* ---------- èŠå¤©çª—å£æ ·å¼ ---------- */
    #ai-chat-window {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 400px;
      max-height: 550px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      z-index: 10000;
      display: none;
      flex-direction: column;
      overflow: hidden;
      transition: all 0.3s ease;  /* è¿‡æ¸¡åŠ¨ç”» */
    }

    /* æœ€å¤§åŒ–çŠ¶æ€æ ·å¼ */
    #ai-chat-window.maximized {
      bottom: 0;
      right: 0;
      width: 100%;
      height: 100%;
      max-height: 100%;
      border-radius: 0;
    }

    /* æ»‘å…¥åŠ¨ç”»ï¼ˆå¤‡ç”¨ï¼‰ */
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ---------- èŠå¤©çª—å£å¤´éƒ¨æ ·å¼ ---------- */
    #ai-chat-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    /* ---------- API Key è¾“å…¥åŒºåŸŸæ ·å¼ ---------- */
    #ai-api-key-section {
      padding: 20px;
      background: linear-gradient(to bottom, #f8f9ff 0%, #ffffff 100%);
      border-bottom: 1px solid #e0e7ff;
    }

    /* API Key è¾“å…¥æ¡† */
    #ai-api-key {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e7ff;
      border-radius: 12px;
      font-size: 14px;
      font-family: 'Courier New', monospace;  /* ç­‰å®½å­—ä½“ */
      transition: all 0.3s;
      background: white;
    }

    /* è¾“å…¥æ¡†èšç„¦æ•ˆæœ */
    #ai-api-key:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* API Key åŒºåŸŸçš„æŒ‰é’® */
    #ai-api-key-section button {
      padding: 12px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    #ai-api-key-section button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    }

    #ai-api-key-section button:active {
      transform: translateY(0);
    }

    /* ---------- èŠå¤©æ¶ˆæ¯åŒºåŸŸæ ·å¼ ---------- */
    #ai-chat-messages {
      flex: 1;
      overflow-y: auto;  /* å‚ç›´æ»šåŠ¨ */
      padding: 20px;
      background: linear-gradient(to bottom, #fafbff 0%, #f5f7ff 100%);
      scroll-behavior: smooth;  /* å¹³æ»‘æ»šåŠ¨ */
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    #ai-chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    #ai-chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    #ai-chat-messages::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 3px;
    }

    #ai-chat-messages::-webkit-scrollbar-thumb:hover {
      background: #a0aec0;
    }

    /* ---------- èŠå¤©æ¶ˆæ¯æ°”æ³¡æ ·å¼ ---------- */
    .ai-message {
      margin-bottom: 16px;
      padding: 14px 18px;
      border-radius: 18px;
      left: 20px;
      max-width: 85%;
      word-wrap: break-word;
      line-height: 1.5;
      animation: messageSlide 0.3s ease-out;  /* æ¶ˆæ¯æ»‘å…¥åŠ¨ç”» */
      position: relative;
    }

    /* æ¶ˆæ¯æ»‘å…¥åŠ¨ç”» */
    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ç”¨æˆ·æ¶ˆæ¯æ ·å¼ï¼šå³å¯¹é½ï¼Œç´«è‰²æ¸å˜èƒŒæ™¯ */
    .ai-user-message {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    /* AIæ¶ˆæ¯æ ·å¼ï¼šå·¦å¯¹é½ï¼Œç™½è‰²èƒŒæ™¯ */
    .ai-bot-message {
      background: white;
      color: #2d3748;
      margin-right: auto;
      border: 1px solid #e2e8f0;
      border-bottom-left-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    /* AIæ¶ˆæ¯å‰çš„æœºå™¨äººå›¾æ ‡ */
    .ai-bot-message::before {
      content: 'ğŸ¤–';
      position: absolute;
      left: -35px;
      top: 0;
      font-size: 24px;
    }

    /* é”™è¯¯æ¶ˆæ¯æ ·å¼ */
    .ai-error-message {
      background: linear-gradient(135deg, #fc5c7d 0%, #6a82fb 100%);
      color: white;
      margin-right: auto;
      border-bottom-left-radius: 4px;
      box-shadow: 0 4px 12px rgba(252, 92, 125, 0.3);
    }

    /* é”™è¯¯æ¶ˆæ¯å‰çš„è­¦å‘Šå›¾æ ‡ */
    .ai-error-message::before {
      content: 'âš ï¸';
      position: absolute;
      left: -32px;
      top: 0;
      font-size: 24px;
    }

    /* åŠ è½½ä¸­æ¶ˆæ¯æ ·å¼ */
    .ai-loading {
      background: white;
      color: #718096;
      margin-right: auto;
      border: 1px solid #e2e8f0;
      font-style: italic;
      border-bottom-left-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    /* åŠ è½½ä¸­çš„å…‰æ ‡é—ªçƒæ•ˆæœ */
    .ai-loading::after {
      content: '';
      display: inline-block;
      width: 4px;
      height: 16px;
      background: #718096;
      margin-left: 4px;
      animation: blink 1s infinite;
    }

    /* å…‰æ ‡é—ªçƒåŠ¨ç”» */
    @keyframes blink {
      0%, 100% {
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
    }

    /* ---------- ç”¨æˆ·è¾“å…¥åŒºåŸŸæ ·å¼ ---------- */
    #ai-chat-input-section {
      padding: 20px;
      background: white;
      border-top: 1px solid #e2e8f0;
      display: flex;
      gap: 12px;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
    }

    /* ---------- é»˜è®¤é—®é¢˜åŒºåŸŸæ ·å¼ ---------- */
    #ai-default-questions {
      padding: 0;
      background: linear-gradient(to bottom, #f5f7ff 0%, #fafbff 100%);
      border-top: 1px solid #e2e8f0;
    }

    /* é»˜è®¤é—®é¢˜æ ‡é¢˜æ ï¼ˆå¯ç‚¹å‡»æŠ˜å ï¼‰ */
    .default-questions-header {
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .default-questions-header:hover {
      background: rgba(102, 126, 234, 0.05);
    }

    /* æŠ˜å ç®­å¤´ */
    #default-questions-arrow {
      font-size: 12px;
      color: #718096;
      transition: transform 0.3s ease;
    }

    /* æŠ˜å çŠ¶æ€çš„ç®­å¤´æ—‹è½¬ */
    #default-questions-arrow.collapsed {
      transform: rotate(-90deg);
    }

    /* é»˜è®¤é—®é¢˜å†…å®¹åŒºåŸŸ */
    #default-questions-content {
      padding: 0 20px 12px 20px;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      max-height: 200px;
    }

    /* æŠ˜å çŠ¶æ€çš„å†…å®¹åŒºåŸŸ */
    #default-questions-content.collapsed {
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
    }

    /* é»˜è®¤é—®é¢˜æ ‡é¢˜æ–‡å­— */
    .default-questions-title {
      font-size: 12px;
      color: #718096;
      font-weight: 500;
    }

    /* é»˜è®¤é—®é¢˜æŒ‰é’®æ ·å¼ */
    .default-question-btn {
      display: inline-block;
      padding: 8px 14px;
      margin: 4px 6px 4px 0;
      background: white;
      border: 1px solid #e0e7ff;
      border-radius: 20px;  /* åœ†è§’èƒ¶å›Šå½¢çŠ¶ */
      font-size: 13px;
      color: #667eea;
      cursor: pointer;
      transition: all 0.2s;
    }

    /* é»˜è®¤é—®é¢˜æŒ‰é’®æ‚¬åœæ•ˆæœ */
    .default-question-btn:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    /* ---------- ç”¨æˆ·è¾“å…¥æ¡†æ ·å¼ ---------- */
    #ai-user-input {
      flex: 1;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      font-size: 14px;
      resize: none;  /* ç¦æ­¢è°ƒæ•´å¤§å° */
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      transition: all 0.3s;
      background: #fafbff;
    }

    #ai-user-input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    #ai-user-input::placeholder {
      color: #a0aec0;
    }

    /* ---------- å‘é€æŒ‰é’®æ ·å¼ ---------- */
    #ai-send-btn {
      padding: 14px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 56px;
    }

    #ai-send-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    }

    #ai-send-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    /* ç¦ç”¨çŠ¶æ€çš„å‘é€æŒ‰é’® */
    #ai-send-btn:disabled {
      background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
      cursor: not-allowed;
      box-shadow: none;
    }

    /* ---------- å“åº”å¼å¸ƒå±€ï¼šç§»åŠ¨ç«¯é€‚é… ---------- */
    @media (max-width: 480px) {
      #ai-chat-window {
        width: 100%;
        height: 100%;
        bottom: 0;
        right: 0;
        border-radius: 0;
      }

      #ai-chat-toggle {
        bottom: 16px;
        right: 16px;
      }
    }
  </style>

  <!-- ==================== JavaScripté€»è¾‘éƒ¨åˆ† ==================== -->
  <script>
    // ========== å…¨å±€å˜é‡åˆå§‹åŒ– ==========

    // è§£ç éšè—çš„JSONæ•°æ®ï¼ˆBase64 -> UTF-8 -> JSONå¯¹è±¡ï¼‰
    const hiddenJsonMeta = document.getElementById('hidden-json-data').textContent.trim();
    const hiddenJsonData = JSON.parse(decodeURIComponent(escape(window.atob(hiddenJsonMeta))));

    // ä»localStorageè¯»å–å·²ä¿å­˜çš„APIå¯†é’¥
    let aiApiKey = localStorage.getItem('deepseek_api_key') || '';

    // èŠå¤©å†å²è®°å½•æ•°ç»„ï¼Œç”¨äºç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡
    let chatHistory = [];

    // åŠ è½½æŒ‡ç¤ºå™¨å…ƒç´ å¼•ç”¨
    const loadingIndicator = document.getElementById('loading-indicator');

    // ========== é¡µé¢ç»“æœå±•ç¤ºç›¸å…³ ==========

    // é—®é¢˜å…³é”®è¯åˆ—è¡¨ï¼šåŒ…å«è¿™äº›å…³é”®è¯çš„é—®é¢˜ä¼šå°†AIå›ç­”å±•ç¤ºåˆ°é¡µé¢
    const displayKeywords = ['ç»†èƒ', 'åŸºå› ', 'ç±»å‹', 'æ³¨é‡Š', 'èšç±»', 'ç»†èƒç¾¤', 'é€šè®¯', 'é€šä¿¡', 'ä¿¡å·', 'æ€»ç»“', 'å‘ç°', 'åˆ†æ'];

    /**
     * æ ¹æ®é—®é¢˜å°†AIå›ç­”å±•ç¤ºåˆ°é¡µé¢
     * @param {string} question - ç”¨æˆ·çš„é—®é¢˜
     * @param {string} aiResponse - AIçš„å›ç­”
     * @returns {boolean} æ˜¯å¦æˆåŠŸå±•ç¤º
     */
    function displayResultByQuestion(question, aiResponse) {
      // æ£€æŸ¥é—®é¢˜æ˜¯å¦åŒ…å«å…³é”®è¯
      for (const keyword of displayKeywords) {
        if (question.includes(keyword)) {
          showResultParagraph(question, aiResponse);
          return true;
        }
      }
      return false;
    }

    /**
     * åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºç»“æœæ®µè½
     * @param {string} question - é—®é¢˜ä½œä¸ºæ ‡é¢˜
     * @param {string} content - AIå›ç­”ä½œä¸ºå†…å®¹
     */
    function showResultParagraph(question, content) {
      const displayDiv = document.getElementById('ai-result-display');
      const paragraph = document.createElement('div');
      paragraph.className = 'ai-result-paragraph';
      paragraph.innerHTML = `
        <div class="result-title">${question}</div>
        <div class="result-content">${content}</div>
      `;
      displayDiv.appendChild(paragraph);
      // å¹³æ»‘æ»šåŠ¨åˆ°ç»“æœä½ç½®
      paragraph.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // ========== APIå¯†é’¥éªŒè¯ç›¸å…³ ==========

    /**
     * æ£€æŸ¥DeepSeek APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
     * @param {string} apiKey - DeepSeek APIå¯†é’¥
     * @returns {Promise<{valid: boolean, message: string}>} éªŒè¯ç»“æœ
     */
    async function checkDeepSeekApiKey(apiKey) {
      if (!apiKey) {
        return { valid: false, message: 'APIå¯†é’¥ä¸èƒ½ä¸ºç©º' };
      }

      try {
        // è°ƒç”¨DeepSeekçš„æ¨¡å‹åˆ—è¡¨æ¥å£ä½œä¸ºéªŒè¯
        const response = await fetch('https://api.deepseek.com/v1/models', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          return { valid: true, message: 'APIå¯†é’¥æœ‰æ•ˆ' };
        } else if (response.status === 401) {
          return { valid: false, message: 'APIå¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸ' };
        } else if (response.status === 429) {
          return { valid: true, message: 'APIå¯†é’¥æœ‰æ•ˆï¼Œä½†è¯·æ±‚é¢‘ç‡è¶…é™' };
        } else {
          const errorData = await response.json().catch(() => ({}));
          return {
            valid: false,
            message: `éªŒè¯å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}ï¼ŒåŸå› : ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`
          };
        }
      } catch (error) {
        return {
          valid: false,
          message: `è¯·æ±‚å¤±è´¥: ${error.message || 'ç½‘ç»œé”™è¯¯æˆ–æœåŠ¡ä¸å¯ç”¨'}`
        };
      }
    }

    /**
     * åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæœ‰æ•ˆçš„JSONæ ¼å¼å­—ç¬¦ä¸²
     * @param {any} variable - éœ€è¦åˆ¤æ–­çš„å˜é‡
     * @returns {boolean} æ˜¯å¦ä¸ºæœ‰æ•ˆJSON
     */
    function isJsonString(variable) {
      if (typeof variable !== 'string') {
        return false;
      }
      try {
        const parsed = JSON.parse(variable);
        return typeof parsed === 'object' && parsed !== null;
      } catch (error) {
        return false;
      }
    }

    // ========== èŠå¤©å†å²åˆå§‹åŒ– ==========

    /**
     * åˆå§‹åŒ–èŠå¤©å†å²
     * å°†éšè—çš„JSONæ•°æ®è½¬æ¢ä¸ºç³»ç»Ÿæç¤ºï¼Œä½œä¸ºAIçš„èƒŒæ™¯çŸ¥è¯†
     * @returns {Array} åˆå§‹åŒ–çš„èŠå¤©å†å²æ•°ç»„
     */
    function initializeChatHistory() {
      const history = [];

      // æ·»åŠ ç³»ç»Ÿè§’è‰²æç¤º
      history.push({
        role: 'system',
        content: hiddenJsonData.system
      });

      // éå†JSONä¸Šä¸‹æ–‡ï¼Œå°†æ¯ä¸ªæ•°æ®é¡¹ä½œä¸ºç³»ç»Ÿæ¶ˆæ¯æ·»åŠ 
      const jsonContext = hiddenJsonData.context;
      for (const key1 in jsonContext) {
        for (const key2 in jsonContext[key1]) {
          let info = jsonContext[key1][key2];
          // å¯¹è±¡ç±»å‹è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
          if (typeof info === 'object') {
            info = JSON.stringify(info, null, 2);
          }
          history.push({
            role: 'system',
            content: info
          });
        }
      }

      // æ·»åŠ å›ç­”æŒ‡ä»¤
      history.push({
        role: 'system',
        content: hiddenJsonData.instructions
      });

      return history;
    }

    // ========== é¡µé¢åŠ è½½äº‹ä»¶ ==========

    /**
     * é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦å·²ä¿å­˜API Key
     * å¦‚æœæœ‰æœ‰æ•ˆçš„API Keyï¼Œè‡ªåŠ¨åˆå§‹åŒ–èŠå¤©
     */
    window.addEventListener('load', async function () {
      if (aiApiKey) {
        const result = await checkDeepSeekApiKey(aiApiKey);
        if (result.valid) {
          // åˆå§‹åŒ–èŠå¤©å†å²
          chatHistory = chatHistory.concat(initializeChatHistory());
          // éšè—API Keyè¾“å…¥åŒºåŸŸ
          document.getElementById('ai-api-key-section').style.display = 'none';
          // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
          addMessage('æ‚¨å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è§£ç­”å…³äºè¿™ä»½ç©ºé—´è½¬å½•ç»„åˆ†ææŠ¥å‘Šçš„é—®é¢˜ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ', 'bot');
        } else {
          updateApiKeyStatus(result.message, false);
        }
      }
    });

    // ========== UIäº¤äº’å‡½æ•° ==========

    /**
     * åˆ‡æ¢èŠå¤©çª—å£æ˜¾ç¤º/éšè—
     */
    function toggleChat() {
      const chatWindow = document.getElementById('ai-chat-window');
      const chatToggle = document.getElementById('ai-chat-toggle');

      if (chatWindow.style.display === 'none') {
        chatWindow.style.display = 'flex';
        chatToggle.style.display = 'none';
      } else {
        chatWindow.style.display = 'none';
        chatToggle.style.display = 'block';
        // å…³é—­æ—¶å–æ¶ˆæœ€å¤§åŒ–çŠ¶æ€
        chatWindow.classList.remove('maximized');
        document.getElementById('ai-maximize-btn').textContent = 'â›¶';
      }
    }

    /**
     * åˆ‡æ¢èŠå¤©çª—å£æœ€å¤§åŒ–/è¿˜åŸ
     */
    function toggleMaximize() {
      const chatWindow = document.getElementById('ai-chat-window');
      const maxBtn = document.getElementById('ai-maximize-btn');

      if (chatWindow.classList.contains('maximized')) {
        chatWindow.classList.remove('maximized');
        maxBtn.textContent = 'â›¶';  // æœ€å¤§åŒ–å›¾æ ‡
      } else {
        chatWindow.classList.add('maximized');
        maxBtn.textContent = 'â§‰';  // è¿˜åŸå›¾æ ‡
      }
    }

    /**
     * ä¿å­˜API Key
     * éªŒè¯åå­˜å‚¨åˆ°localStorageå¹¶åˆå§‹åŒ–èŠå¤©
     */
    async function saveApiKey() {
      const apiKeyInput = document.getElementById('ai-api-key');
      aiApiKey = apiKeyInput.value.trim();

      if (!aiApiKey) {
        updateApiKeyStatus("è¯·è¾“å…¥æœ‰æ•ˆçš„APIå¯†é’¥", false);
        return;
      }

      const result = await checkDeepSeekApiKey(aiApiKey);
      if (result.valid) {
        // ä¿å­˜åˆ°localStorage
        localStorage.setItem('deepseek_api_key', aiApiKey);
        // åˆå§‹åŒ–èŠå¤©å†å²
        chatHistory = chatHistory.concat(initializeChatHistory());
        // éšè—API Keyè¾“å…¥åŒºåŸŸ
        document.getElementById('ai-api-key-section').style.display = 'none';
        // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        addMessage('æ‚¨å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è§£ç­”å…³äºè¿™ä»½ç©ºé—´è½¬å½•ç»„åˆ†ææŠ¥å‘Šçš„é—®é¢˜ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ', 'bot');
      } else {
        updateApiKeyStatus(result.message, false);
      }
    }

    /**
     * æ›´æ–°API KeyçŠ¶æ€æ˜¾ç¤º
     * @param {string} message - çŠ¶æ€æ¶ˆæ¯
     * @param {boolean} isSuccess - æ˜¯å¦æˆåŠŸ
     */
    function updateApiKeyStatus(message, isSuccess) {
      const statusElement = document.getElementById("api-key-status");
      if (statusElement) {
        statusElement.textContent = message;
        statusElement.className = "api-key-status " + (isSuccess ? "success" : "error");
      }
    }

    // ========== æ¶ˆæ¯å¤„ç†å‡½æ•° ==========

    /**
     * æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
     * @param {string} content - æ¶ˆæ¯å†…å®¹
     * @param {string} type - æ¶ˆæ¯ç±»å‹ï¼š'user'|'bot'|'error'|'loading'
     * @returns {HTMLElement} åˆ›å»ºçš„æ¶ˆæ¯å…ƒç´ 
     */
    function addMessage(content, type) {
      const messagesDiv = document.getElementById('ai-chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'ai-message';

      // æ ¹æ®ç±»å‹æ·»åŠ å¯¹åº”æ ·å¼ç±»
      if (type === 'user') {
        messageDiv.classList.add('ai-user-message');
      } else if (type === 'bot') {
        messageDiv.classList.add('ai-bot-message');
      } else if (type === 'error') {
        messageDiv.classList.add('ai-error-message');
      } else if (type === 'loading') {
        messageDiv.classList.add('ai-loading');
        messageDiv.classList.add('ai-bot-message');
        messageDiv.id = 'loading-message';
      }

      messageDiv.textContent = content;
      messagesDiv.appendChild(messageDiv);
      // æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      return messageDiv;
    }

    /**
     * å‘é€æ¶ˆæ¯åˆ°DeepSeek API
     * ä¸»è¦çš„èŠå¤©é€»è¾‘å‡½æ•°
     */
    async function sendMessage() {
      // æ£€æŸ¥API Key
      if (!aiApiKey) {
        alert('è¯·å…ˆè¾“å…¥å¹¶ä¿å­˜ DeepSeek API Key');
        document.getElementById('ai-api-key-section').style.display = 'flex';
        return;
      }

      const userInput = document.getElementById('ai-user-input');
      const message = userInput.value.trim();

      // æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦ä¸ºç©º
      if (!message) {
        return;
      }

      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ç•Œé¢å’Œå†å²è®°å½•
      addMessage(message, 'user');
      chatHistory.push({
        role: 'user',
        content: message
      });

      // ä¿å­˜å½“å‰é—®é¢˜ï¼Œç”¨äºåç»­åˆ¤æ–­æ˜¯å¦å±•ç¤ºåˆ°é¡µé¢
      const currentQuestion = message;

      // æ¸…ç©ºè¾“å…¥æ¡†
      userInput.value = '';

      // ç¦ç”¨å‘é€æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤å‘é€
      const sendBtn = document.getElementById('ai-send-btn');
      sendBtn.disabled = true;

      // æ˜¾ç¤ºåŠ è½½ä¸­æ¶ˆæ¯
      const loadingMsg = addMessage('æ­£åœ¨æ€è€ƒä¸­...', 'loading');

      try {
        // è°ƒç”¨DeepSeek API
        const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + aiApiKey
          },
          body: JSON.stringify({
            model: 'deepseek-chat',
            messages: chatHistory,
            temperature: 0.7,  // æ§åˆ¶å›ç­”çš„éšæœºæ€§
            max_tokens: 2000   // æœ€å¤§è¿”å›tokenæ•°
          })
        });

        // å¤„ç†é”™è¯¯å“åº”
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.error?.message || 'è¯·æ±‚å¤±è´¥: ' + response.status);
        }

        // è§£æå“åº”æ•°æ®
        const data = await response.json();
        const assistantMessage = data.choices[0].message.content;

        // æ·»åŠ AIå›å¤åˆ°ç•Œé¢å’Œå†å²è®°å½•
        addMessage(assistantMessage, 'bot');
        chatHistory.push({
          role: 'assistant',
          content: assistantMessage
        });

        // æ ¹æ®é—®é¢˜å…³é”®è¯å°†AIå›ç­”å±•ç¤ºåˆ°é¡µé¢ä¸»ä½“
        displayResultByQuestion(currentQuestion, assistantMessage);

        // ç§»é™¤åŠ è½½ä¸­æ¶ˆæ¯
        loadingMsg.remove();

      } catch (error) {
        // ç§»é™¤åŠ è½½ä¸­æ¶ˆæ¯
        if (document.getElementById('loading-message')) {
          document.getElementById('loading-message').remove();
        }

        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        addMessage('é”™è¯¯: ' + error.message, 'error');
        console.error('DeepSeek API Error:', error);

        // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œé‡æ–°æ˜¾ç¤ºAPI Keyè¾“å…¥åŒºåŸŸ
        if (error.message.includes('401') || error.message.includes('Unauthorized')) {
          document.getElementById('ai-api-key-section').style.display = 'flex';
          localStorage.removeItem('deepseek_api_key');
          aiApiKey = '';
        }
      } finally {
        // æ¢å¤å‘é€æŒ‰é’®
        sendBtn.disabled = false;
      }
    }

    /**
     * ç‚¹å‡»é»˜è®¤é—®é¢˜æŒ‰é’®
     * @param {string} question - é¢„è®¾çš„é—®é¢˜
     */
    function askDefaultQuestion(question) {
      if (!aiApiKey) {
        alert('è¯·å…ˆè¾“å…¥å¹¶ä¿å­˜ DeepSeek API Key');
        document.getElementById('ai-api-key-section').style.display = 'flex';
        return;
      }
      // å°†é—®é¢˜å¡«å…¥è¾“å…¥æ¡†å¹¶å‘é€
      document.getElementById('ai-user-input').value = question;
      sendMessage();
    }

    /**
     * å±•å¼€/æ”¶èµ·é»˜è®¤é—®é¢˜åŒºåŸŸ
     */
    function toggleDefaultQuestions() {
      const content = document.getElementById('default-questions-content');
      const arrow = document.getElementById('default-questions-arrow');

      content.classList.toggle('collapsed');
      arrow.classList.toggle('collapsed');
    }

    // ========== äº‹ä»¶ç›‘å¬ ==========

    /**
     * DOMåŠ è½½å®Œæˆåç»‘å®šå›è½¦å‘é€äº‹ä»¶
     */
    document.addEventListener('DOMContentLoaded', function () {
      const userInput = document.getElementById('ai-user-input');
      if (userInput) {
        userInput.addEventListener('keypress', function (e) {
          // æŒ‰ä¸‹å›è½¦é”®ï¼ˆéShift+å›è½¦ï¼‰å‘é€æ¶ˆæ¯
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        });
      }
    });
  </script>
</body>

</html>
